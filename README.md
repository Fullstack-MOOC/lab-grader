# Lab + Autograder: Local and Coursera Testing

This repo contains a Coursera Lab image (`coursera-labs/cs52`) and a Cypress-based Docker autograder (`assignment/autograder`).

## Quick local checks

- Build the autograder image and run locally against the sample project in `volumes/project/react-intro-template`.
- Produce `feedback.json` and `htmlFeedback.html` as Coursera would.

### 1) Build the autograder image

```zsh
docker build -t grader:latest assignment/autograder
```

### 2) Run local grading

If you have the Coursera CLI autograder tool available (bundled under `assignment/grader-venv/`):

```zsh
assignment/grader-venv/bin/coursera_autograder grade local grader volumes/project/react-intro-template '{"partId":"TEST"}' --mem-limit 2048 --dst-dir assignment/results
```

Outputs:
- `assignment/results/feedback.json`
- `assignment/results/htmlFeedback.html`

## Package artifacts for Coursera

Use helper scripts to zip the lab and autograder for upload.

```zsh
# Package the lab image bundle
chmod +x scripts/package-lab.sh && scripts/package-lab.sh

# Package the autograder bundle
chmod +x scripts/package-grader.sh && scripts/package-grader.sh
```

Zips are written to the `dist/` directory.

## Upload to Coursera and test

1) Create/Edit a Lab item:
- Upload the lab zip produced above.
- Port: 8080 (as defined in `manifest.json`).
- Mounts: default (Coursera will map `/home/coder/project` from `manifest.json`).
- Save and launch the lab to confirm the environment starts and the dev server is reachable via the launch button.

2) Create/Edit the autograded assignment/part:
- Upload the autograder zip produced above.
- Ensure the part maps to the same course item learners will submit from.

3) Test end-to-end:
- In the lab, make a submission (via the course UI Submit button).
- Coursera will pass the workspace snapshot to the autograder container, mounting it at `/shared/submission`.
- The autograder writes `/shared/feedback.json` and `/shared/htmlFeedback.html`.
- Check the submission results page for the score and feedback.

## Notes
- The autograder script discovers the project root, installs npm deps, starts the Vite dev server on `PORT` (default 8080), waits for readiness, and runs Cypress component + e2e tests.
- Results are parsed from `results/component_feedback.json` and `results/e2e_feedback.json` generated by `cypress-ctrf-json-reporter`.
- If your project is slow to boot, increase the server wait loop in `assignment/autograder/grader.sh`.